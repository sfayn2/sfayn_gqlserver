@startuml Two Modes - Technical View
!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist
!include AWSPuml/AWSCommon.puml
!include AWSPuml/General/Users.puml
!include AWSPuml/NetworkingContentDelivery/APIGateway.puml
!include AWSPuml/Compute/Lambda.puml
!include AWSPuml/Database/DynamoDB.puml
!include AWSPuml/Storage/SimpleStorageService.puml
!include AWSPuml/ApplicationIntegration/EventBridge.puml

left to right direction

'--- Actors ---
Users(sources, "Multi Tenants", "Request via GraphQL or Webhook ")

'--- Entry Points (Primary Adapters) ---
APIGateway(tenantOMSApi, "Unified Entry Point", "GraphQL & Webhook Gateway")

'--- The Business Logic (Domain Core) ---
SimpleStorageService(DDD, "Domain Core (DDD)", "Python Logic & Lambda Layers")

'--- Adapters ---
Lambda(graphqlRequest, "GraphQL Adapter", "Translates API requests to Domain commands")
Lambda(webhookRequest, "Webhook Adapter", "Translates external webhooks to Domain commands")
Lambda(eventHandler, "Async Event Adapter", "Consumes Bus events for Domain processing")

'--- Infrastructure (Secondary Adapters) ---
DynamoDB(orderDb, "State Store", "Single-Table Design (Orders)")
EventBridge(event, "Domain Event Bus", "Central Asynchronous Message Backbone")

'--- Relationships ---
sources --> tenantOMSApi : "Submits Request"

' Logical coupling to Domain Core
DDD ..> graphqlRequest : "Injected via Layers"
DDD ..> webhookRequest : "Injected via Layers"
DDD ..> eventHandler   : "Injected via Layers"

tenantOMSApi --> graphqlRequest : "Routes GraphQL"
graphqlRequest <--> orderDb : "Reads/Writes State"
graphqlRequest --> event : "Publishes Domain Event"

tenantOMSApi --> webhookRequest : "Routes Webhook"
webhookRequest --> event : "Publishes Domain Event"
webhookRequest <--> orderDb : "Reads/Writes State"

event --> eventHandler : "Triggers Handler"
@enduml
